name: "ğŸŒŸ Thetah Advanced Deployment System"

on:
  workflow_dispatch:
    inputs:
      INSTANCE:
        description: "Instance number to deploy (e.g., 1, 2, 3...)"
        required: true
        default: "1"

jobs:
  deploy-thetah:
    name: "ğŸš€ Launch Thetah Instance ${{ github.event.inputs.INSTANCE }}"
    runs-on: windows-latest

    env:
      INSTANCE_ID: ${{ github.event.inputs.INSTANCE }}
      SECRET_TOKEN: ${{ secrets.SECRET_TOKEN }}
      NGROK_TOKEN: ${{ secrets.NGROK_TOKEN }}
      REPO: ${{ github.repository }}
      WORKFLOW_FILE: "thetah.yml"
      DEPLOYMENT_ID: ${{ github.run_id }}

    steps:
      - name: ğŸ¯ System Configuration
        shell: pwsh
        run: |
          $prevInstance = [int]$env:INSTANCE_ID - 1
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
          Write-Host "â•‘              THETAH DEPLOYMENT MATRIX            â•‘" -ForegroundColor Cyan
          Write-Host "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£" -ForegroundColor Cyan
          Write-Host "â•‘ âš¡ Active Instance    : $env:INSTANCE_ID                            â•‘" -ForegroundColor Green
          Write-Host "â•‘ ğŸ”„ Previous Instance : $prevInstance                            â•‘" -ForegroundColor Yellow
          Write-Host "â•‘ ğŸ“ Repository        : $env:REPO" -ForegroundColor Magenta
          Write-Host "â•‘ ğŸ”§ Workflow Engine   : $env:WORKFLOW_FILE                  â•‘" -ForegroundColor Blue
          Write-Host "â•‘ ğŸ†” Deployment Hash   : $env:DEPLOYMENT_ID" -ForegroundColor Red
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan

      - name: ğŸ”’ Authentication Protocol
        shell: pwsh
        run: |
          Write-Host "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor DarkCyan
          Write-Host "â”‚       CREDENTIAL VERIFICATION      â”‚" -ForegroundColor DarkCyan
          Write-Host "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" -ForegroundColor DarkCyan
          if (-not $env:SECRET_TOKEN) {
            Write-Host "âŒ CRITICAL: Missing GitHub Secret: SECRET_TOKEN" -ForegroundColor Red
            exit 1
          }
          if (-not $env:NGROK_TOKEN) {
            Write-Host "âŒ CRITICAL: Missing Ngrok Auth Token: NGROK_TOKEN" -ForegroundColor Red
            exit 1
          }
          Write-Host "âœ… Security tokens validated - ACCESS GRANTED" -ForegroundColor Green

      - name: ğŸ“¦ Resource Acquisition
        shell: pwsh
        run: |
          $url = "https://gitlab.com/brianmayaka90/thetah/-/raw/main/Thetah-instance.ps1"
          Write-Host "â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®" -ForegroundColor Magenta
          Write-Host "â”‚      THETAH CORE ACQUISITION       â”‚" -ForegroundColor Magenta
          Write-Host "â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯" -ForegroundColor Magenta
          Write-Host "ğŸŒ Fetching Thetah-instance.ps1..." -ForegroundColor Cyan
          Invoke-WebRequest -Uri $url -OutFile "Thetah-instance.ps1" -UseBasicParsing
          if (!(Test-Path "./Thetah-instance.ps1")) {
            Write-Host "âŒ FATAL: Failed to acquire Thetah-instance.ps1" -ForegroundColor Red
            exit 1
          }
          Write-Host "âœ… Thetah core module acquired successfully" -ForegroundColor Green

      - name: âš¡ Thetah Core Execution
        shell: pwsh
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Yellow
          Write-Host "â•‘                THETAH CORE IGNITION                â•‘" -ForegroundColor Yellow
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Yellow
          Write-Host "ğŸ”¥ Initializing Thetah-instance.ps1..." -ForegroundColor Red
          powershell.exe -ExecutionPolicy Bypass -File ".\Thetah-instance.ps1"

      - name: ğŸ† Mission Status Report
        if: always()
        shell: pwsh
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Green
          Write-Host "â•‘                DEPLOYMENT COMPLETED                  â•‘" -ForegroundColor Green
          Write-Host "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£" -ForegroundColor Green
          Write-Host "â•‘ âœ… Thetah Instance $env:INSTANCE_ID - MISSION ACCOMPLISHED    â•‘" -ForegroundColor White
          Write-Host "â•‘ ğŸ”‹ System Status: OPERATIONAL                        â•‘" -ForegroundColor White
          Write-Host "â•‘ ğŸ¯ Deployment executed with precision                â•‘" -ForegroundColor White
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
